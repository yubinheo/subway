<!DOCTYPE html>
<html lang="kr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="./public/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <title>KSubway - 지하철 위치 정보</title>
</head>

<body>
    <br /><br /><br />



    <div class="chat">
        <div class="chat-header clearfix">
            <div class="row">
                <div class="col-lg-6">
                    <a href="javascript:void(0);" data-toggle="modal" data-target="#view_info">
                        <img src="https://blog.kakaocdn.net/dn/biQ6Vq/btraVoKV4Bq/JKemnd8Kiblq3ijOgYNcA1/img.png" alt="avatar">
                    </a>
                    <div class="chat-about">
                        <h6 class="m-b-0">지하철 알리미</h6>
                        <small>계속 활성화중</small>
                    </div>
                </div>
                <div class="col-lg-6 hidden-sm text-right">
                    <a href="javascript:void(0);" class="btn btn-outline-secondary"><i class="fa fa-camera"></i></a>
                    <a href="javascript:void(0);" class="btn btn-outline-primary"><i class="fa fa-image"></i></a>
                    <a href="javascript:void(0);" class="btn btn-outline-info"><i class="fa fa-cogs"></i></a>
                    <a href="javascript:void(0);" class="btn btn-outline-warning"><i class="fa fa-question"></i></a>
                </div>
            </div>
        </div>
        <div class="chat-history">
            <ul class="m-b-0" id="chat">
                <li class="clearfix">
                    <div class="message-data text-right">
                        <span class="message-data-time">Today</span>
                        <img src="https://blog.kakaocdn.net/dn/biQ6Vq/btraVoKV4Bq/JKemnd8Kiblq3ijOgYNcA1/img.png" alt="avatar">
                    </div>
                    <div class="message other-message float-right">

                        지하철 정보를 확인하고 싶다면, 아래 글을 확인해! <br />
                        <hr />
                        확인하고자 할 노선 번호를 입력 박스에 입력하고 엔터를 누르세요. <br />
                        EX) 1호선 (엔터)<br /><br />

                        지원 노선 : 1 ~ 9호선, 경의중앙선, 경춘선, 신분당선, 공항철도, 우이신설선

                    </div>
                </li>
            </ul>
        </div>
        <div class="chat-message clearfix">
            <div class="input-group mb-0">
                <div class="input-group-prepend">
                    <span class="input-group-text"><i class="fa fa-send"></i></span>
                </div>
                <input type="text" id="line" class="form-control" placeholder="노선 입력 (EX : 공항철도)"
                    onkeyup="if(window.event.keyCode==13){go()}">
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>

        function isMobile() {
            var UserAgent = navigator.userAgent;

            if (UserAgent.match(/iPhone|iPod|Android|Windows CE|BlackBerry|Symbian|Windows Phone|webOS|Opera Mini|Opera Mobi|POLARIS|IEMobile|lgtelecom|nokia|SonyEricsson/i) != null || UserAgent.match(/LG|SAMSUNG|Samsung/) != null) {
                return true;
            } else {
                return false;
            }
        }

        if (!isMobile()) {
            alert("본 웹사이트는 모바일에 최적화되어 있습니다.");
        }

        function checkLine(line) {
            if (line == "1호선" || line == "2호선" || line == "3호선" || line == "4호선" || line == "5호선"
                || line == "6호선" || line == "7호선" || line == "8호선" || line == "9호선"
                || line == "공항철도" || line == "우이신설선" || line == "신분당선") {
                return true;
            } else {
                return false;
            }
        }

        function getLineData(line) {
            $.ajax({
                url: `http://swopenapi.seoul.go.kr/api/subway/4842436e50676a643439624f646761/xml/realtimePosition/0/1000/${line}`, // 읽어올 문서 
                type: 'GET', // 방식 
                dataType: 'xml', // 문서 타입 
                timeout: 1000, // 시간 설정 
                error: function () { // 로딩 에러시 
                    alert('Error loading XML document');
                }, success: function (xml) {
                    let contents = ` [${line} 실시간 열차 알림] <br /><hr />`;
                    $(xml).find('row').each(function () {
                        var trainNo = $(this).find("trainNo").text(); // 열번
                        var updnline = $(this).find("updnLine").text(); // 상하행선 구분
                        var statnNm = $(this).find("statnNm").text() + "역"; // 열차 위치
                        var recptnDt = $(this).find("recptnDt").text(); // 업데이트 시간
                        var statnTnm = $(this).find("statnTnm").text() + "행"; // 종착역
                        var trainSttus = $(this).find("trainSttus").text(); // 열차 상태
                        var directAt = $(this).find("directAt").text(); // 열차 구분 (급행, 일반)
                        var lstcarAt = $(this).find("lstcarAt").text(); // 막차 여부


                        if (line == "2호선" && $(this).find("updnLine").text() == "0") {
                            updnline = "외선순환";
                        } else if (line == "2호선" && $(this).find("updnLine").text() == "1") {
                            updnline = "내선순환";
                        } else if (line != "2호선" && $(this).find("updnLine").text() == "0") {
                            updnline = "상행";
                        } else if (line != "2호선" && $(this).find("updnLine").text() == "1") {
                            updnline = "하행";
                        } else {
                            updnline = "알 수 없음";
                        }

                        if ($(this).find("trainSttus").text() == "0") {
                            trainSttus = "진입";
                        } else if ($(this).find("trainSttus").text() == "1") {
                            trainSttus = "도착";
                        } else {
                            trainSttus = "출발";
                        }

                        if ($(this).find("directAt").text() == "0") {
                            directAt = "일반열차";
                        } else if ($(this).find("directAt").text() == "1") {
                            directAt = "급행열차";
                        } else {
                            directAt = "알 수 없음";
                        }

                        if ($(this).find("lstcarAt").text() == "0") {
                            lstcarAt = "";
                        } else if ($(this).find("lstcarAt").text() == "1") {
                            lstcarAt = "(마지막 열차)";
                        } else {
                            lstcarAt = "알 수 없음";
                        }

                        contents +=
                            `
                        #${trainNo} (${statnTnm}, ${updnline}) ${directAt} ${lstcarAt} <br />
                        열차 상태 : ${statnNm} ${trainSttus}<br />
                        업데이트 시간 : ${recptnDt}
                        <hr />
                        `;
                    });

                    $("#chat").append(
                        `<li class="clearfix">
                            <div class="message-data text-right">
                                <span class="message-data-time">Today</span>
                                <img src="https://blog.kakaocdn.net/dn/biQ6Vq/btraVoKV4Bq/JKemnd8Kiblq3ijOgYNcA1/img.png" alt="avatar">
                            </div>
                            <div class="message other-message float-right">
                                ${contents}
                            </div>
                        </li>
                    `);
                    window.scrollTo(0, document.body.scrollHeight);
                }
            });
        }

        function go() {
            const line = document.getElementById('line').value;
            document.getElementById("line").value = "";

            if (checkLine(line)) {
                getLineData(line);
            } else {
                alert("호선 번호를 정확하게 입력해주세요.")
            }


        }

    </script>

</body>

</html>